#!/usr/bin/env node

const NG       = require( "../lib/jsNG" );
const NGParser = require( "../lib/jsNGParser" );
const ngdump   = require( "commander" );

ngdump
    .usage( "[options] <file ...>")
    .version( NG.version )
    .description( "Dump the contents of the given Norton Guide files" )
    .option( "-o, --output <type>", "output type", /^(raw|plain|color|colour)$/i, "colour" )
    .parse( process.argv );

if ( ngdump.args.length > 0 ) {

    try {

        let output;

        switch ( ngdump.output ) {
            case "plain":
                output = NGParser.Line.toPlainText;
                break;
            case "color":
            case "colour":
                output = NGParser.Line.toTerminalText;
                break;
            default:
                output = s => s;
        }

        for ( file of ngdump.args ) {
            const ng = new NG.Guide( file ).open();
            if ( ng.isNG() ) {

                for ( let entry of ng ) {
                    entry.lines().forEach( l => console.log( output( l ) ) );
                    if ( entry.hasSeeAlso() ) {
                        console.log( "See Also: " + entry.seeAlso().prompts().join( ", " ) );
                    }
                }
            }
        }
    } catch ( e ) {
        console.log( "Error: " + e.message );
        process.exitCode = 1;
    }
} else {
    ngdump.help();
}
